@model HospitalApplication.Models.ViewModels.NewProcedure
@using System;
@using System.Globalization;
@using System.Diagnostics;

@{
    ViewBag.Title = "New";
}


<h2>Add a New Procedure</h2>
<a href="/Procedure/List">Return to Procedure List</a>
<form action="/Procedure/Create" method="POST">
    <div>
        <label>Procedure Name:</label>
        <input type="text" name="ProcedureName" />
    </div>
    <div>
        <label>Doctor:</label>
        <select name="ProcedureDoctor">
            @foreach (var doctor in Model.DoctorOptions)
            {
                <option value="@doctor.DoctorId">Dr. @doctor.DoctorFirstName  @doctor.DoctorLastName</option>
            }
        </select>
    </div>
    <div>
        <label>Patient:</label>
        <select name="ProcedurePatient">
            @foreach (var patient in Model.PatientOptions)
            {
                <option value="@patient.PatientId"> @patient.PatientFirstName  @patient.PatientLastName</option>
            }
        </select>
    </div>
    <div>
        <label>Duration:</label>
        <input type="number" name="Duration" />
    </div>
    <div>
        <label>Room:</label>
        <select name="ProcedureRoom">
            @foreach (var room in Model.RoomOptions)
            {
                <option value="@room.RoomId">Room @room.RoomNumber - @room.RoomPurpose</option>
            }
        </select>
    </div>
    <div>
        <label>Time:</label>
        <input type="time" name="Time" />

        <!-- <input type="time" name="Time" /> -->
        <!-- Attempted dropdown menu with range of pre-selected times.
             Ran into a commuication issue between this new input and our data controller where the new converted DataTime variables wouldn't be accepted
             (got error message "The conversion of a datetime2 data type to a datetime data type resulted in an out-of-range value"), any soutions we found online didn't solve it.
             Reverted back to our old set up for now.
    <select>
        {

        int increment = 30;
        string timeframe = "";
        string timeString = "";

        for (int i = 800; i <= 1530; i = i + increment)
        {
            if (i % 20 == 0)
            {
                increment = 30;
            }
            else
            {
                increment = 70;
            }
            if (i < 1200)
            {
                timeframe = "AM";
            }
            else
            {
                timeframe = "PM";
            }

            if (i < 1000)
            {
                timeString = "0" + i.ToString();
            }

            else
            {
                timeString = i.ToString();
            }

            DateTime? timeValue = DateTime.ParseExact(timeString, "HHmm", CultureInfo.InvariantCulture);
            Debug.WriteLine(timeValue);


            <option value="timeValue">timeValue.ToString("HH:mm") timeframe</option>
        }
    }
    </select>
    -->

    </div>
    <div>
        <label>Date:</label>
        <input type="date" name="Date" />
    </div>
    <div class="submit-container">
        <input type="submit" value="Add Procedure" />
    </div>

</form>


